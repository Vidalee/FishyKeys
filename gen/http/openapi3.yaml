openapi: 3.0.3
info:
    title: FishyKeys API
    description: The FishyKeys API for key management
    version: "1.0"
servers:
    - url: http://localhost:8080
paths:
    /key_management/create_master_key:
        post:
            tags:
                - key_management
            summary: create_master_key key_management
            description: Create a new master key and split it into shares
            operationId: key_management#create_master_key
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateMasterKeyRequestBody'
                        example:
                            min_shares: 3
                            total_shares: 5
            responses:
                "201":
                    description: Created response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CreateMasterKeyResponseBody'
                            example:
                                shares:
                                    - Repudiandae blanditiis id cupiditate unde eos.
                                    - Sit ratione.
                                    - Et ut magnam labore molestiae.
                "400":
                    description: 'invalid_parameters: Bad Request response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Ipsam eos ut repellendus sunt.
                            example: Ab qui harum distinctio.
                "409":
                    description: 'key_already_exists: Conflict response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Voluptatem ad amet sint est.
                            example: Excepturi dolorum sed consequatur eos doloribus sit.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Qui sint sapiente architecto.
                            example: Cumque amet et.
    /key_management/share:
        delete:
            tags:
                - key_management
            summary: delete_share key_management
            description: Delete a share from the key management system
            operationId: key_management#delete_share
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/DeleteShareRequestBody'
                        example:
                            index: 1
            responses:
                "200":
                    description: OK response.
                "400":
                    description: 'wrong_index: Bad Request response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Natus dignissimos.
                            example: Maiores at et ut occaecati harum maiores.
                "404":
                    description: 'no_key_set: Not Found response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Fugiat ut.
                            example: Doloremque possimus.
                "409":
                    description: 'key_already_unlocked: Conflict response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Inventore nostrum minima et.
                            example: Ducimus eum qui est.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Consequatur illum totam officiis.
                            example: Commodi rerum quo excepturi.
        post:
            tags:
                - key_management
            summary: add_share key_management
            description: Add a share to unlock the master key
            operationId: key_management#add_share
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/AddShareRequestBody'
                        example:
                            share: EXAMPLEA5ZKwDn8Zotr3B+d+F+UzrcJ1Yhl2rU0
            responses:
                "201":
                    description: Created response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AddShareResponseBody'
                            example:
                                index: 5890167680709064409
                                unlocked: true
                "400":
                    description: 'wrong_shares: Bad Request response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Est temporibus nam.
                            example: Rerum ab et aliquam.
                "404":
                    description: 'no_key_set: Not Found response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Omnis quia et repellat natus quidem impedit.
                            example: Asperiores architecto similique quia illo eos quasi.
                "409":
                    description: 'key_already_unlocked: Conflict response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Vel non nam magnam beatae ipsa.
                            example: Dolorem fuga cupiditate alias quis voluptatibus dignissimos.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Natus rerum optio est laborum.
                            example: Et eveniet.
    /key_management/status:
        get:
            tags:
                - key_management
            summary: get_key_status key_management
            description: Get the current status of the master key
            operationId: key_management#get_key_status
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetKeyStatusResponseBody'
                            example:
                                current_shares: 6718364374947157668
                                is_locked: false
                                min_shares: 7654723300438466742
                                total_shares: 53511470712771686
                "404":
                    description: 'no_key_set: Not Found response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Et qui et quis eaque eius.
                            example: Magni veniam occaecati.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Dignissimos vel.
                            example: Rerum autem rerum omnis reiciendis.
    /users:
        get:
            tags:
                - users
            summary: list users
            description: List all users
            operationId: users#list
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/User'
                                example:
                                    - created_at: Id fuga in numquam voluptatem.
                                      updated_at: Eveniet laudantium est incidunt ut.
                                      username: Saepe nesciunt aut.
                                    - created_at: Id fuga in numquam voluptatem.
                                      updated_at: Eveniet laudantium est incidunt ut.
                                      username: Saepe nesciunt aut.
                                    - created_at: Id fuga in numquam voluptatem.
                                      updated_at: Eveniet laudantium est incidunt ut.
                                      username: Saepe nesciunt aut.
                            example:
                                - created_at: Id fuga in numquam voluptatem.
                                  updated_at: Eveniet laudantium est incidunt ut.
                                  username: Saepe nesciunt aut.
                                - created_at: Id fuga in numquam voluptatem.
                                  updated_at: Eveniet laudantium est incidunt ut.
                                  username: Saepe nesciunt aut.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Officia earum totam esse quaerat velit.
                            example: Quas ut.
        post:
            tags:
                - users
            summary: create users
            description: Create a new user
            operationId: users#create
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateRequestBody'
                        example:
                            password: s3cr3t
                            username: alice
            responses:
                "201":
                    description: Created response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CreateResponseBody'
                            example:
                                username: Dignissimos libero ea nobis praesentium non.
                "400":
                    description: 'invalid_input: Bad Request response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Nam voluptatem maiores qui velit.
                            example: Est et expedita doloremque architecto commodi rerum.
                "409":
                    description: 'username_taken: Conflict response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Corrupti aut.
                            example: Aut quis.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Excepturi deserunt omnis aliquam.
                            example: Nam nobis libero repudiandae.
    /users/{username}:
        delete:
            tags:
                - users
            summary: delete users
            description: Delete a user by username
            operationId: users#delete
            parameters:
                - name: username
                  in: path
                  description: Username of the user to delete
                  required: true
                  schema:
                    type: string
                    description: Username of the user to delete
                    example: alice
                  example: alice
            responses:
                "200":
                    description: OK response.
                "404":
                    description: 'user_not_found: Not Found response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Sint porro.
                            example: Ex hic placeat maxime.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Est et corrupti culpa minus velit.
                            example: Eligendi quae adipisci occaecati.
    /users/auth:
        post:
            tags:
                - users
            summary: auth users
            description: Authenticate a user with username and password
            operationId: users#auth
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateRequestBody'
                        example:
                            password: s3cr3t
                            username: alice
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AuthResponseBody'
                            example:
                                token: Occaecati nesciunt eos commodi.
                                username: Sequi accusantium fugit sed.
                "401":
                    description: 'unauthorized: Unauthorized response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Itaque magnam atque est.
                            example: Quam modi.
                "500":
                    description: 'internal_error: Internal Server Error response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Sit sit in rem.
                            example: Ipsum sapiente et quia.
components:
    schemas:
        AddShareRequestBody:
            type: object
            properties:
                share:
                    type: string
                    description: One of the shares need to unlock the master key
                    example: EXAMPLEA5ZKwDn8Zotr3B+d+F+UzrcJ1Yhl2rU0
            example:
                share: EXAMPLEA5ZKwDn8Zotr3B+d+F+UzrcJ1Yhl2rU0
            required:
                - share
        AddShareResponseBody:
            type: object
            properties:
                index:
                    type: integer
                    description: The index of the share added
                    example: 6424931001824332862
                    format: int64
                unlocked:
                    type: boolean
                    description: Whether the master key has been unlocked
                    example: false
            example:
                index: 945154162230229594
                unlocked: true
            required:
                - index
                - unlocked
        AuthResponseBody:
            type: object
            properties:
                token:
                    type: string
                    description: JWT or session token
                    example: Sint voluptas aspernatur.
                username:
                    type: string
                    description: The username of the authenticated user
                    example: Est sit dignissimos.
            example:
                token: Dolorem sed incidunt id dolore sed.
                username: Cupiditate sint molestiae adipisci architecto.
        CreateMasterKeyRequestBody:
            type: object
            properties:
                min_shares:
                    type: integer
                    description: Minimum number of shares required to reconstruct the key
                    example: 3
                    format: int64
                total_shares:
                    type: integer
                    description: Total number of shares to create
                    example: 5
                    format: int64
            example:
                min_shares: 3
                total_shares: 5
            required:
                - total_shares
                - min_shares
        CreateMasterKeyResponseBody:
            type: object
            properties:
                shares:
                    type: array
                    items:
                        type: string
                        example: Qui quia et similique.
                    description: The generated key shares
                    example:
                        - Et animi.
                        - Sed sed accusantium commodi.
            example:
                shares:
                    - Molestias quasi.
                    - Cupiditate eos et nisi eos beatae.
                    - Eligendi consequatur voluptas.
        CreateRequestBody:
            type: object
            properties:
                password:
                    type: string
                    description: Password (hashed or plain depending on implementation)
                    example: s3cr3t
                username:
                    type: string
                    description: Username of the new user
                    example: alice
            example:
                password: s3cr3t
                username: alice
            required:
                - username
                - password
        CreateResponseBody:
            type: object
            properties:
                username:
                    type: string
                    description: The username of the created user
                    example: Voluptatem qui et.
            example:
                username: Quos officiis.
        DeleteShareRequestBody:
            type: object
            properties:
                index:
                    type: integer
                    description: The index of the share to delete
                    example: 1
                    format: int64
            example:
                index: 1
            required:
                - index
        GetKeyStatusResponseBody:
            type: object
            properties:
                current_shares:
                    type: integer
                    description: Number of shares currently held
                    example: 3204362017974806603
                    format: int64
                is_locked:
                    type: boolean
                    description: Whether the key is currently locked
                    example: true
                min_shares:
                    type: integer
                    description: Minimum number of shares required
                    example: 7390922679859328998
                    format: int64
                total_shares:
                    type: integer
                    description: Total number of shares
                    example: 7362036207563285969
                    format: int64
            example:
                current_shares: 1961684668140663594
                is_locked: false
                min_shares: 3468115806578446057
                total_shares: 7109564824357408988
            required:
                - is_locked
                - current_shares
                - min_shares
                - total_shares
        User:
            type: object
            properties:
                created_at:
                    type: string
                    description: User creation timestamp
                    example: Illo impedit debitis quia.
                updated_at:
                    type: string
                    description: User last update timestamp
                    example: Autem ut necessitatibus dolor earum aut.
                username:
                    type: string
                    description: The username
                    example: Voluptatem consequatur sint asperiores natus aliquam.
            example:
                created_at: Eum necessitatibus perspiciatis.
                updated_at: Aperiam nemo et rerum quidem expedita.
                username: Esse dolores aut quia ea.
            required:
                - username
                - created_at
                - updated_at
tags:
    - name: key_management
      description: The FishyKeys server handles master key operations
    - name: users
      description: User service manages user accounts and authentication
